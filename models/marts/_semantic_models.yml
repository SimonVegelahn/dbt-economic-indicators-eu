# ============================================
# SEMANTIC LAYER DEFINITIONS
# ============================================
# MetricFlow semantic models define a consistent
# business logic layer for metrics.
#
# Benefits:
# - Single source of truth for metric definitions
# - Consistent calculations across BI tools
# - Self-service analytics with guardrails
# ============================================

semantic_models:
  # ============================================
  # Semantic Model: Monthly Economic Indicators
  # ============================================
  - name: monthly_economic_indicators
    description: >
      Monthly economic indicators fact table for time series analysis.
      Provides unemployment and inflation metrics at monthly grain.
    model: ref('fct_economic_indicators')
    
    defaults:
      agg_time_dimension: metric_month
    
    entities:
      - name: indicator
        type: primary
        expr: indicator_key
      - name: country
        type: foreign
        expr: country_code
    
    dimensions:
      - name: country_code
        type: categorical
        expr: country_code
        description: ISO 2-letter country code
        
      - name: metric_month
        type: time
        type_params:
          time_granularity: month
        expr: reference_date
        description: Reference month for the indicator
        
      - name: reference_year
        type: categorical
        expr: reference_year
        description: Reference year (for filtering)

    measures:
      - name: unemployment_rate
        description: Monthly unemployment rate (seasonally adjusted)
        agg: average
        expr: unemployment_rate_pct
        
      - name: inflation_rate_mom
        description: Month-over-month inflation rate
        agg: average
        expr: inflation_rate_mom_pct
        
      - name: unemployment_12m_rolling_avg
        description: 12-month rolling average unemployment
        agg: average
        expr: unemployment_rate_12m_avg
        
      - name: observation_count
        description: Count of monthly observations
        agg: count
        expr: indicator_key

  # ============================================
  # Semantic Model: Annual Economic Summary
  # ============================================
  - name: annual_economic_summary
    description: >
      Annual economic summary for high-level reporting.
      Pre-aggregated metrics with rankings and EU comparisons.
    model: ref('rpt_annual_economic_summary')
    
    defaults:
      agg_time_dimension: fiscal_year
    
    entities:
      - name: annual_summary
        type: primary
        expr: summary_key
      - name: country
        type: foreign
        expr: country_code
    
    dimensions:
      - name: country_code
        type: categorical
        expr: country_code
        
      - name: country_name
        type: categorical
        expr: country_name
        
      - name: eu_status
        type: categorical
        expr: eu_status
        description: "Eurozone, EU (non-Euro), or Non-EU"
        
      - name: region
        type: categorical
        expr: region
        description: Geographic region within Europe
        
      - name: fiscal_year
        type: time
        type_params:
          time_granularity: year
        expr: make_date(reference_year, 1, 1)
        
      - name: is_eurozone
        type: categorical
        expr: eurozone_member

    measures:
      - name: gdp_million_eur
        description: GDP in million EUR
        agg: sum
        expr: gdp_million_eur
        
      - name: population
        description: Total population
        agg: sum
        expr: population_count
        
      - name: gdp_per_capita
        description: GDP per capita in EUR
        agg: average
        expr: gdp_per_capita_eur
        
      - name: avg_unemployment
        description: Average annual unemployment rate
        agg: average
        expr: avg_unemployment_rate_pct
        
      - name: total_inflation
        description: Total annual inflation rate
        agg: average
        expr: annual_inflation_rate_pct
        
      - name: gdp_growth_rate
        description: Year-over-year GDP growth percentage
        agg: average
        expr: gdp_yoy_growth_pct
        
      - name: country_count
        description: Count of countries
        agg: count_distinct
        expr: country_code


# ============================================
# METRIC DEFINITIONS
# ============================================
# Metrics are business-defined calculations
# that can be queried via the Semantic Layer API.
# ============================================

metrics:
  # ============================================
  # GDP Metrics
  # ============================================
  - name: total_gdp
    description: >
      Total Gross Domestic Product in million EUR.
      Sum of GDP across selected countries.
    type: simple
    label: Total GDP (M EUR)
    type_params:
      measure: gdp_million_eur
    meta:
      team: economics
      tier: tier_1

  - name: average_gdp_per_capita
    description: >
      Average GDP per capita in EUR.
      Useful for cross-country wealth comparison.
    type: simple
    label: Avg GDP per Capita (EUR)
    type_params:
      measure: gdp_per_capita
    meta:
      team: economics
      tier: tier_1

  - name: gdp_growth
    description: >
      Average year-over-year GDP growth rate.
      Measures economic expansion/contraction.
    type: simple
    label: GDP Growth Rate (%)
    type_params:
      measure: gdp_growth_rate
    meta:
      team: economics
      tier: tier_1

  # ============================================
  # Labor Market Metrics
  # ============================================
  - name: unemployment_rate
    description: >
      Average unemployment rate as percentage of active population.
      Seasonally adjusted for comparability.
    type: simple
    label: Unemployment Rate (%)
    type_params:
      measure: unemployment_rate
    meta:
      team: economics
      tier: tier_1

  - name: unemployment_trend
    description: >
      12-month rolling average unemployment rate.
      Smooths out monthly volatility for trend analysis.
    type: simple
    label: Unemployment Trend (12M Avg)
    type_params:
      measure: unemployment_12m_rolling_avg
    meta:
      team: economics
      tier: tier_2

  # ============================================
  # Inflation Metrics
  # ============================================
  - name: monthly_inflation
    description: >
      Average month-over-month inflation rate (HICP).
      Based on Harmonised Index of Consumer Prices.
    type: simple
    label: Monthly Inflation (%)
    type_params:
      measure: inflation_rate_mom
    meta:
      team: economics
      tier: tier_1

  - name: annual_inflation
    description: >
      Average annual inflation rate.
      Sum of monthly rates for the year.
    type: simple
    label: Annual Inflation (%)
    type_params:
      measure: total_inflation
    meta:
      team: economics
      tier: tier_1

  # ============================================
  # Derived / Ratio Metrics
  # ============================================
  - name: gdp_per_capita_derived
    description: >
      GDP per capita calculated as total GDP / population.
      Derived metric for validation against pre-calculated values.
    type: derived
    label: GDP per Capita (Derived)
    type_params:
      expr: (total_gdp * 1000000) / population
      metrics:
        - name: total_gdp
        - name: population
    meta:
      team: economics
      tier: tier_2
      
  - name: population
    description: >
      Total population count.
      Population on January 1st of the reference year.
    type: simple
    label: Population
    type_params:
      measure: population
    meta:
      team: demographics
      tier: tier_1

  # ============================================
  # Cumulative Metrics
  # ============================================
  - name: cumulative_gdp_growth
    description: >
      Cumulative GDP growth since the start of the selected period.
      Useful for measuring recovery from specific events.
    type: cumulative
    label: Cumulative GDP Growth
    type_params:
      measure: gdp_growth_rate
      cumulative_type_params:
        window: unbounded
    meta:
      team: economics
      tier: tier_3
